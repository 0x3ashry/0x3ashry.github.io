<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Nest — Hack The Box [Write-up]" /><meta name="author" content="0x3ashry" /><meta property="og:locale" content="en" /><meta name="description" content="Writeup for Nest Hackthebox Machine" /><meta property="og:description" content="Writeup for Nest Hackthebox Machine" /><link rel="canonical" href="https://0x3ashry.github.io/posts/Nest-Hack-The-Box-Write-up/" /><meta property="og:url" content="https://0x3ashry.github.io/posts/Nest-Hack-The-Box-Write-up/" /><meta property="og:site_name" content="0x3ashry’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-05-25T16:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Nest — Hack The Box [Write-up]" /><meta name="twitter:site" content="@0x3ashry" /><meta name="twitter:creator" content="@0x3ashry" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"0x3ashry"},"dateModified":"2022-05-26T03:44:06+02:00","datePublished":"2022-05-25T16:00:00+02:00","description":"Writeup for Nest Hackthebox Machine","headline":"Nest — Hack The Box [Write-up]","mainEntityOfPage":{"@type":"WebPage","@id":"https://0x3ashry.github.io/posts/Nest-Hack-The-Box-Write-up/"},"url":"https://0x3ashry.github.io/posts/Nest-Hack-The-Box-Write-up/"}</script><title>Nest — Hack The Box [Write-up] | 0x3ashry's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="0x3ashry's Blog"><meta name="application-name" content="0x3ashry's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-512x512.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">0x3ashry's Blog</a></div><div class="site-subtitle font-italic">CyberSecurity geek, who wants to share his day-to-day knowledge</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/0x3ashry" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/0x3ashry" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['antony.magdy13','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Nest — Hack The Box [Write-up]</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Nest — Hack The Box [Write-up]</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1653487200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 25, 2022 </em> </span> <span> Updated <em class="" data-ts="1653529446" data-df="ll" data-toggle="tooltip" data-placement="bottom"> May 26, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> Antony Magdy </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1060 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/img/HTB/Nest/Nest.png" alt="" data-proofer-ignore></p><p>Nest is one of the most challenging easy machines on HTB including a lot of new aspects as cryptography, de-compiling .Net application and extensive work with SMB shares. So let’s get started…</p><h4 id="used-tools"><span class="mr-2">Used Tools:</span><a href="#used-tools" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ul><li>nmap<li>smbmap<li>smbclient<li>mount<li>telnet<li>psexec.py</ul><h2 id="1-scanning--enumeration"><span class="mr-2">1. SCANNING &amp; ENUMERATION</span><a href="#1-scanning--enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I will start with nmap and the -A parameter to enable OS detection, version detection, script scanning, and traceroute and append the output to tee command which save the in a file named “nmap” and also show the output on the screen.</p><p><img data-src="/img/HTB/Nest/img (1).png" alt="" data-proofer-ignore></p><p>We found 2 opened ports:</p><ul><li>445 for SMB<li>4386 Unkown service</ul><p>Of course let’s start with the smb and try mapping its shares</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbmap <span class="nt">-H</span> 10.10.10.178 <span class="nt">-u</span> Anonymous
</pre></table></code></div></div><p><img data-src="/img/HTB/Nest/img (2).png" alt="" data-proofer-ignore></p><p>Found 2 shares with <strong>read access only</strong>:</p><ul><li>Data<li>Users</ul><p>Let’s start with <code class="language-plaintext highlighter-rouge">Data</code> and connect to it using <code class="language-plaintext highlighter-rouge">smbclient</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbclient <span class="nt">-U</span> <span class="s2">""</span> //10.10.10.178/Data
</pre></table></code></div></div><p>After some directory traversing I found a file under <code class="language-plaintext highlighter-rouge">\Shared\Templates\HR</code> called “Welcome Email.txt” which looks interesting…</p><p><img data-src="/img/HTB/Nest/img (3).png" alt="" data-proofer-ignore></p><p>After downloading it, found that it was a welcome email sent from HR to a new user called <code class="language-plaintext highlighter-rouge">TempUser</code> with username and password.</p><p><img data-src="/img/HTB/Nest/img (4).png" alt="" data-proofer-ignore></p><p>Let’s connect again with the new creds…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbclient <span class="nt">-U</span> <span class="s2">"TempUser"</span> <span class="nt">--password</span> welcome2019 //10.10.10.178/Data
</pre></table></code></div></div><p>I found that now I have access to the <code class="language-plaintext highlighter-rouge">IT</code> directory</p><p><img data-src="/img/HTB/Nest/img (5).png" alt="" data-proofer-ignore></p><p>But it has a lot of files so let’s mount it and have a local copy of it, it would be easier</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>mount <span class="nt">-o</span> <span class="nv">user</span><span class="o">=</span>TemUser <span class="nt">-t</span> cifs //10.10.10.178/Data /mnt/nest
</pre></table></code></div></div><h2 id="2-exploitation"><span class="mr-2">2. EXPLOITATION:</span><a href="#2-exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><img data-src="/img/HTB/Nest/img (6).png" alt="" data-proofer-ignore></p><p>After some directory traversing I found 2 very important files:</p><ul><li><code class="language-plaintext highlighter-rouge">RU_config.xml</code> –&gt; //10.10.10.179/Data/IT/Configs/RU Scanner/RU_config.xml<li><code class="language-plaintext highlighter-rouge">config.xml</code> –&gt; //10.10.10.179/Data/IT/Configs/NotepadPlusPlus/config.xml</ul><p><strong>RU_config contain Username <code class="language-plaintext highlighter-rouge">C.smith</code> and encrypted password</strong></p><p><img data-src="/img/HTB/Nest/img (7).png" alt="" data-proofer-ignore></p><p>But it is encrypted so we had to continue…</p><p><strong>config.xml contains a special path in a share called <code class="language-plaintext highlighter-rouge">Secure$</code></strong></p><p><img data-src="/img/HTB/Nest/img (8).png" alt="" data-proofer-ignore></p><p>I tried smbmap again with the new creds and found that we have access to Secure$, So let’s connect to it…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbclient <span class="nt">-U</span> <span class="s2">"TempUser"</span> <span class="nt">--password</span> welcome2019 //10.10.10.178/Secure<span class="err">$</span>
</pre></table></code></div></div><p>I couldn’t list the contents of IT but navigating to /IT/Carl found a lot of files</p><p><img data-src="/img/HTB/Nest/img (9).png" alt="" data-proofer-ignore></p><p>Mounting Secure$…</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>umount /mnt/nest<span class="p">;</span> <span class="nb">sudo </span>mount <span class="nt">-o</span> <span class="nv">user</span><span class="o">=</span>TempUser <span class="nt">-t</span> cifs //10.10.10.178/Secure<span class="nv">$ </span>/mnt/nest/
<span class="nb">cd</span> /mnt/nest/
<span class="nb">cd </span>IT/Carl
find <span class="nb">.</span>
</pre></table></code></div></div><p><img data-src="/img/HTB/Nest/img (10).png" alt="" data-proofer-ignore></p><p>Found file called <code class="language-plaintext highlighter-rouge">Module1.vb</code> at and it loads <code class="language-plaintext highlighter-rouge">RU_Config.xml</code> and calles a function called <code class="language-plaintext highlighter-rouge">DecryptString</code> from a library called <code class="language-plaintext highlighter-rouge">Utils</code> which is interesting…</p><p><img data-src="/img/HTB/Nest/img (11).png" alt="" data-proofer-ignore></p><p>I found also a file called <code class="language-plaintext highlighter-rouge">Utils.vb</code> which i think is the called library</p><p>It is a library that have 4 functions, 2 for password encoding and other 2 for password decoding</p><p><code class="language-plaintext highlighter-rouge">DecryptString</code> function which was called previously calls <code class="language-plaintext highlighter-rouge">Decrypt</code> function which is an AES Encryption cypher with predefined values for the passphrase, salt, number of iterations, initvector and key size in the DecryptString function</p><pre><code class="language-C">    Public Shared Function DecryptString(EncryptedString As String) As String
        If String.IsNullOrEmpty(EncryptedString) Then
            Return String.Empty
        Else
            Return Decrypt(EncryptedString, "N3st22", "88552299", 2, "464R5DFA5DL6LE28", 256)
        End If
    End Function
</code></pre><pre><code class="language-C">    Public Shared Function Decrypt(ByVal cipherText As String, _
                                   ByVal passPhrase As String, _
                                   ByVal saltValue As String, _
                                    ByVal passwordIterations As Integer, _
                                   ByVal initVector As String, _
                                   ByVal keySize As Integer) _
                           As String

        Dim initVectorBytes As Byte()
        initVectorBytes = Encoding.ASCII.GetBytes(initVector)

        Dim saltValueBytes As Byte()
        saltValueBytes = Encoding.ASCII.GetBytes(saltValue)

        Dim cipherTextBytes As Byte()
        cipherTextBytes = Convert.FromBase64String(cipherText)

        Dim password As New Rfc2898DeriveBytes(passPhrase, _
                                           saltValueBytes, _
                                           passwordIterations)

        Dim keyBytes As Byte()
        keyBytes = password.GetBytes(CInt(keySize / 8))

        Dim symmetricKey As New AesCryptoServiceProvider
        symmetricKey.Mode = CipherMode.CBC

        Dim decryptor As ICryptoTransform
        decryptor = symmetricKey.CreateDecryptor(keyBytes, initVectorBytes)

        Dim memoryStream As IO.MemoryStream
        memoryStream = New IO.MemoryStream(cipherTextBytes)

        Dim cryptoStream As CryptoStream
        cryptoStream = New CryptoStream(memoryStream, _
                                        decryptor, _
                                        CryptoStreamMode.Read)

        Dim plainTextBytes As Byte()
        ReDim plainTextBytes(cipherTextBytes.Length)

        Dim decryptedByteCount As Integer
        decryptedByteCount = cryptoStream.Read(plainTextBytes, _
                                               0, _
                                               plainTextBytes.Length)

        memoryStream.Close()
        cryptoStream.Close()

        Dim plainText As String
        plainText = Encoding.ASCII.GetString(plainTextBytes, _
                                            0, _
                                            decryptedByteCount)

        Return plainText
    End Function
</code></pre><p>All we have to do is to re run the code but replacing the <code class="language-plaintext highlighter-rouge">EncryptedString</code> parameter in DecryptString with our password hash we found for <code class="language-plaintext highlighter-rouge">C.smith</code>…</p><p>I will use online VB compiler from codingrooms.com and add the previous 2 function in addition to this submain function to call them:</p><pre><code class="language-C">Sub Main()
    Dim password as String
    password = DecryptString("fTEzAfYDoz1YzkqhQkH6GQFYKp1XY5hm7bjOP86yYxE=")
    Console.WriteLine(password)

End Sub
</code></pre><p>You’ll find the code here: <code class="language-plaintext highlighter-rouge">https://pastebin.com/1SAnwkSb</code></p><p>We successfully decrypted the hash: <code class="language-plaintext highlighter-rouge">xRxRxPANCAK3SxRxRx</code></p><p><img data-src="/img/HTB/Nest/img (12).png" alt="" data-proofer-ignore></p><p>Now let’s access the Users share with the C.smith creds</p><p><img data-src="/img/HTB/Nest/img (13).png" alt="" data-proofer-ignore></p><p>BOOOOOOOOM ! We got the user flag.</p><h2 id="3-privilege-escalation"><span class="mr-2">3. PRIVILEGE ESCALATION:</span><a href="#3-privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Along with the user flag, we find a folder <code class="language-plaintext highlighter-rouge">HQK Reporting</code> that contains an executable file called <code class="language-plaintext highlighter-rouge">HqkLdap.exe</code> in a subfolder called <code class="language-plaintext highlighter-rouge">AD Integration Module</code>. We get as well a <em>strange</em> empty file called <code class="language-plaintext highlighter-rouge">Debug Mode Password.txt</code>:</p><p>So let’s mount the share and see it</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>umount /mnt/nest<span class="p">;</span> <span class="nb">sudo </span>mount <span class="nt">-o</span> <span class="nv">user</span><span class="o">=</span>C.smith <span class="nt">-t</span> cifs //10.10.10.178/Users /mnt/nest/
<span class="nb">cd</span> <span class="s2">"/mnt/nest/C.smith/HQK Reporting"</span>
</pre></table></code></div></div><p>Seems like the service running on port <code class="language-plaintext highlighter-rouge">4386</code> is called <code class="language-plaintext highlighter-rouge">HQK Reporting</code>.</p><p><img data-src="/img/HTB/Nest/img (14).png" alt="" data-proofer-ignore></p><p>Connect to it using telnet</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>telnet 10.10.10.178 4386
</pre></table></code></div></div><p><img data-src="/img/HTB/Nest/img (15).png" alt="" data-proofer-ignore></p><p>I didn’t reach anything through the application…</p><p>I stucked a lot but then found this thread talking about Sth called Alternate Data streams (ADS) over SMB LINK: <code class="language-plaintext highlighter-rouge">https://superuser.com/questions/1520250/read-alternate-data-streams-over-smb-with-linux</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>smbclient <span class="nt">-U</span> C.Smith <span class="se">\\\\</span>10.10.10.178<span class="se">\\</span>Users <span class="nt">-c</span> <span class="s1">'allinfo "C.Smith/HQK Reporting/Debug Mode Password.txt"'</span>
</pre></table></code></div></div><p>Indeed it seems like there is an ADS with 15 bytes of data.</p><p><img data-src="/img/HTB/Nest/img (16).png" alt="" data-proofer-ignore></p><p>Connecting to the SMB client and downloading the Debug Mode Password.txt with the ADS using:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>smbclient <span class="nt">-U</span> C.Smith <span class="se">\\\\</span>10.10.10.178<span class="se">\\</span>Users
<span class="nb">cd</span> <span class="s2">"C.Smith</span><span class="se">\H</span><span class="s2">QK Reporting</span><span class="se">\"</span><span class="s2">
get "</span>Debug Mode Password.txt:Password:<span class="nv">$DATA</span><span class="s2">"
</span></pre></table></code></div></div><p>Shows a password that I think it could be used for the DEBUG mode in HQK Reporting…</p><p><img data-src="/img/HTB/Nest/img (17).png" alt="" data-proofer-ignore></p><p>Trying it and it successfully enabled DEBUG mode and we have a new privileges</p><p><img data-src="/img/HTB/Nest/img (18).png" alt="" data-proofer-ignore></p><p><code class="language-plaintext highlighter-rouge">SHOWQUERY</code> in combination with <code class="language-plaintext highlighter-rouge">SETDIR</code> and <code class="language-plaintext highlighter-rouge">LIST</code> gives us arbitrary file-read.</p><p>Using .. for the SETDIR command we can traverse our path and using SHOWQUERY we can read Ldap.conf, which contains the encrypted password for the administrator user.</p><p><img data-src="/img/HTB/Nest/img (19).png" alt="" data-proofer-ignore></p><p>It looks like the old encrypted password for TempUser but I thing the values of the AES Cyphed differ this time so we have to find where the Encryption code is to decode it as previously</p><p>Let us download the <code class="language-plaintext highlighter-rouge">HqkLdap.exe</code> file and <strong>decompile</strong> it to decrypt the administrator password.</p><p>I used dotPeek to decode it.</p><p>At the CR Class in the HqkLdap I found the encryption and decryption functions</p><p><img data-src="/img/HTB/Nest/img (20).png" alt="" data-proofer-ignore></p><p>Repeating the previous decryption steps with changing the values of DecryptString function I managed to get the Administrator password</p><p><img data-src="/img/HTB/Nest/img (21).png" alt="" data-proofer-ignore></p><p>Now that we have the Administrator password , we can use <code class="language-plaintext highlighter-rouge">psexec.py</code> to get a shell as admin</p><p><img data-src="/img/HTB/Nest/img (22).png" alt="" data-proofer-ignore></p><p>BOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOM !!!! Now we are root :D</p><p>Thank you so much for reading and I hope you learned a lot as I did ❤</p><h4 id="0x3ashry"><span class="mr-2"><strong><em>0x3ashry</em></strong></span><a href="#0x3ashry" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Nest+%E2%80%94+Hack+The+Box+%5BWrite-up%5D+-+0x3ashry%27s+Blog&url=https%3A%2F%2F0x3ashry.github.io%2Fposts%2FNest-Hack-The-Box-Write-up%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Nest+%E2%80%94+Hack+The+Box+%5BWrite-up%5D+-+0x3ashry%27s+Blog&u=https%3A%2F%2F0x3ashry.github.io%2Fposts%2FNest-Hack-The-Box-Write-up%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2F0x3ashry.github.io%2Fposts%2FNest-Hack-The-Box-Write-up%2F&text=Nest+%E2%80%94+Hack+The+Box+%5BWrite-up%5D+-+0x3ashry%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Poison-Hack-The-Box-Write-up/">Poison — Hack The Box [Write-up]</a><li><a href="/posts/BYUCTF-2022-Write-up/">BYUCTF 2022 [Write-up]</a><li><a href="/posts/Nest-Hack-The-Box-Write-up/">Nest — Hack The Box [Write-up]</a><li><a href="/posts/Valentine-Hack-The-Box-Write-up/">Valentine — Hack The Box [Write-up]</a><li><a href="/posts/Blunder-Hack-The-Box-Write-up/">Blunder — Hack The Box [Write-up]</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/cryptography/">Cryptography</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/miscellaneous/">Miscellaneous</a> <a class="post-tag" href="/tags/web/">Web</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Grandpa-Hack-The-Box-Write-up/"><div class="card-body"> <em class="small" data-ts="1612069200" data-df="ll" > Jan 31, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Grandpa — Hack The Box [Write-up]</h3><div class="text-muted small"><p> Grandpa is one of the simpler machines on Hack The Box, however it covers the widely-exploited CVE-2017–7269. This vulnerability is trivial to exploit and granted immediate access to thousands of...</p></div></div></a></div><div class="card"> <a href="/posts/Driver-Hack-The-Box-Write-up/"><div class="card-body"> <em class="small" data-ts="1654012800" data-df="ll" > May 31, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Driver — Hack The Box [Write-up]</h3><div class="text-muted small"><p> Driver is an easy rated HTB Windows machine, but it discussed a new techniques in exploiting SMB shares and winRM service in addition to privesc using CVE-2021-34527 - PrintNightmare LPE (PowerSh...</p></div></div></a></div><div class="card"> <a href="/posts/Sense-Hack-The-Box-Write-up/"><div class="card-body"> <em class="small" data-ts="1612245600" data-df="ll" > Feb 2, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Sense — Hack The Box [Write-up]</h3><div class="text-muted small"><p> Sense, while not requiring many steps to complete, can be challenging for some as it is all about enumeration which takes long time for me then every thing goes easy as we will see. Used Tools: ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Networked-Hack-The-Box-Write-up/" class="btn btn-outline-primary" prompt="Older"><p>Networked — Hack The Box [Write-up]</p></a> <a href="/posts/BYUCTF-2022-Write-up/" class="btn btn-outline-primary" prompt="Newer"><p>BYUCTF 2022 [Write-up]</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">Antony Magdy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/cryptography/">Cryptography</a> <a class="post-tag" href="/tags/ctf/">CTF</a> <a class="post-tag" href="/tags/miscellaneous/">Miscellaneous</a> <a class="post-tag" href="/tags/web/">Web</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
